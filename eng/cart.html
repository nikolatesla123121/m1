<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sepet – AlbaSpace</title>
  <!-- Genel site stilleri -->
  <link rel="stylesheet" href="/assets/css/site.css">
  <link rel="stylesheet" href="/assets/css/shop.css">
  <!-- Başlık/menü eklemeleri -->
  <script src="/assets/js/include.js" defer></script>
  <script src="/assets/js/menu-toggle.js" defer></script>
  <!-- Sepet yöneticisi -->
  <script src="/assets/js/cart.js" defer></script>
</head>
<body>
  <!-- Türkçe site başlığı -->
  <div data-include="/header-tr.html"></div>

  <main class="cart-page">
    <h1>Sepet</h1>
    <section id="cartItems"></section>
    <section class="cart-summary" id="cartSummary">
      <div class="cart-total-row">
        <span>Toplam:</span>
        <span id="cartTotal">$0.00</span>
      </div>
      <div class="shipping-estimate">
        <h2>Kargo + İşlem Ücreti Tahmini</h2>
        <form>
          <label>
            Ülke
            <select>
              <option value="Türkiye">Türkiye</option>
              <option value="ABD">Amerika Birleşik Devletleri</option>
              <option value="Birleşik Krallık">Birleşik Krallık</option>
              <option value="Kanada">Kanada</option>
            </select>
          </label>
          <label>
            İl / Bölge
            <input type="text" placeholder="İl veya Bölge">
          </label>
          <label>
            Posta Kodu
            <input type="text" placeholder="Posta Kodu">
          </label>
          <button type="button" class="btn-secondary">Tahmin Et</button>
        </form>
      </div>
      <button class="btn-primary checkout-btn" type="button">ÖDEME</button>
    </section>
    <p id="emptyCartMessage" class="cart-empty" hidden>Sepetin boş.</p>
  </main>

  <!-- Türkçe site altbilgisi -->
  <div data-include="/footer-tr.html"></div>

  <script>
    /*
     * Türkçe sepet sayfasında sepet içeriğini ekrana basar.  #cartItems
     * bölümüne her ürün için bir satır ekler, toplam tutarı günceller
     * ve adet/artır/azalt ile kaldırma düğmelerine olaylar ekler.
     */
    function renderCartTR() {
      const container = document.getElementById('cartItems');
      const summary = document.getElementById('cartSummary');
      const emptyMsg = document.getElementById('emptyCartMessage');
      const totalEl = document.getElementById('cartTotal');
      const cart = cartManager.load();
      if (!cart.length) {
        container.innerHTML = '';
        summary.style.display = 'none';
        emptyMsg.hidden = false;
        return;
      }
      emptyMsg.hidden = true;
      summary.style.display = '';
      let total = 0;
      container.innerHTML = cart.map((item, index) => {
        const itemTotal = item.price * item.qty;
        total += itemTotal;
        const variant = [item.color || '', item.size || ''].filter(Boolean).join(' / ');
        return `
          <article class="cart-item" data-index="${index}">
            <img src="${item.image}" alt="${item.name}">
            <div class="cart-item-main">
              <h2>${item.name}</h2>
              <p>${variant}</p>
              <div class="cart-item-price">$${item.price.toFixed(2)}</div>
            </div>
            <div class="cart-item-actions">
              <div class="qty-control" data-qty>
                <button type="button" class="qty-btn" data-qty-minus>&minus;</button>
                <input type="number" min="1" value="${item.qty}" class="qty-input" data-qty-input>
                <button type="button" class="qty-btn" data-qty-plus>&plus;</button>
              </div>
              <button type="button" class="cart-remove" data-remove>Kaldır</button>
              <div class="cart-item-total">$${itemTotal.toFixed(2)}</div>
            </div>
          </article>
        `;
      }).join('');
      totalEl.textContent = '$' + total.toFixed(2);
      // Olayları bağla
      container.querySelectorAll('.cart-item').forEach(row => {
        const index = Number(row.dataset.index);
        const input = row.querySelector('[data-qty-input]');
        row.querySelector('[data-qty-minus]').addEventListener('click', () => {
          const value = Math.max(1, Number(input.value || '1') - 1);
          input.value = value;
          cartManager.updateQty(index, value);
          renderCartTR();
        });
        row.querySelector('[data-qty-plus]').addEventListener('click', () => {
          const value = Number(input.value || '1') + 1;
          input.value = value;
          cartManager.updateQty(index, value);
          renderCartTR();
        });
        row.querySelector('[data-remove]').addEventListener('click', () => {
          cartManager.remove(index);
          renderCartTR();
        });
      });
    }
    document.addEventListener('DOMContentLoaded', renderCartTR);
  </script>
</body>
</html>